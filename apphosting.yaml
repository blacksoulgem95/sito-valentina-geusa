# Configurazione Firebase App Hosting
# Per maggiori informazioni: https://firebase.google.com/docs/app-hosting/configure

# Impostazioni Cloud Run per il backend
runConfig:
  # Numero di CPU per istanza (default: 0, auto-scaling)
  cpu: 1
  # Memoria in MiB (default: 512)
  # Nota: più di 4 GiB richiedono almeno 2 CPU
  memoryMiB: 1024
  # Numero minimo di istanze sempre attive (default: 0)
  minInstances: 0
  # Numero massimo di istanze (default: 100)
  maxInstances: 10
  # Concorrenza: richieste simultanee per istanza (default: 80)
  concurrency: 80

# Variabili d'ambiente e secret
env:
  # ============================================
  # Variabili Firebase (PUBLIC_ per client-side)
  # ============================================
  # IMPORTANTE: Queste variabili sono NECESSARIE per:
  # 1. Login con email/password - L'API usa Firebase Auth REST API che richiede l'API key
  # 2. Login Google - Firebase SDK client-side per ottenere ID token da Google
  # 3. Eventuali altri usi client-side di Firebase SDK
  #
  # COME OTTENERE L'API KEY:
  # 1. Vai su Firebase Console: https://console.firebase.google.com/
  # 2. Seleziona il tuo progetto
  # 3. Vai su Project Settings (icona ingranaggio) > General
  # 4. Nella sezione "Your apps", trova la Web App
  # 5. Copia il valore di "apiKey" dalla configurazione
  # 6. Sostituisci "your_firebase_api_key_here" qui sotto con il valore reale
  #
  # ALTERNATIVA (Raccomandato per produzione):
  # Configura le variabili direttamente nella Console Firebase:
  # Firebase Console > App Hosting > [Nome Backend] > Settings > Environment variables
  #
  # Queste variabili sono disponibili sia in BUILD che in RUNTIME
  - variable: PUBLIC_FIREBASE_API_KEY
    value: AIzaSyB0VZAdl5KazgCnELPaBSFylf3rTUj6BQk
    availability:
      - BUILD
      - RUNTIME

  - variable: PUBLIC_FIREBASE_AUTH_DOMAIN
    value: sito-valentina-geusa.firebaseapp.com
    availability:
      - BUILD
      - RUNTIME

  - variable: PUBLIC_FIREBASE_PROJECT_ID
    value: sito-valentina-geusa
    availability:
      - BUILD
      - RUNTIME

  - variable: PUBLIC_FIREBASE_STORAGE_BUCKET
    value: sito-valentina-geusa.firebasestorage.app
    availability:
      - BUILD
      - RUNTIME

  - variable: PUBLIC_FIREBASE_MESSAGING_SENDER_ID
    value: 36866585185
    availability:
      - BUILD
      - RUNTIME

  - variable: PUBLIC_FIREBASE_APP_ID
    value: 1:36866585185:web:c52a1bf138190ae571b020
    availability:
      - BUILD
      - RUNTIME

  - variable: PUBLIC_FIREBASE_MEASUREMENT_ID
    value: G-NP9ZZHDSZC
    availability:
      - BUILD
      - RUNTIME

  # ============================================
  # Configurazione Server
  # ============================================
  # Host: ascolta su tutte le interfacce (necessario per Cloud Run)
  - variable: HOST
    value: "0.0.0.0"
    availability:
      - RUNTIME

  # Dominio abilitato per CORS
  - variable: DOMAIN
    value: https://vallmars.it
    availability:
      - RUNTIME

  # Porta: Cloud Run imposta automaticamente PORT, ma possiamo specificarla
  # - variable: PORT
  #   value: "8080"
  #   availability:
  #     - RUNTIME

  # ============================================
  # Variabili Mailgun (SERVER-SIDE ONLY)
  # ============================================
  # IMPORTANTE: Queste variabili contengono informazioni sensibili
  # Dovrebbero essere configurate come SECRET in Cloud Secret Manager
  # Vedi apphosting.md per le istruzioni complete
  #
  # CONFIGURAZIONE MAILGUN EUROPA:
  # Questo progetto usa Mailgun Europa, quindi l'endpoint è:
  # https://api.eu.mailgun.net/v3/
  #
  # Se usi Mailgun USA, cambia MAILGUN_BASE_URL a:
  # https://api.mailgun.net/v3/

  # Base URL per Mailgun (default: Europa)
  - variable: MAILGUN_BASE_URL
    value: https://api.eu.mailgun.net/v3/
    availability:
      - RUNTIME

  # Esempio con valori diretti (NON RACCOMANDATO per produzione):
  - variable: MAILGUN_DOMAIN
    value: vicedomini.cloud
    availability:
      - RUNTIME

  - variable: MAILGUN_API_KEY
    secret: MAILGUN_API_KEY

  - variable: CONTACT_EMAIL
    secret: CONTACT_EMAIL
  - variable: PUBLIC_TURNSTILE_SITE_KEY
    secret: PUBLIC_TURNSTILE_SITE_KEY
  - variable: TURNSTILE_SECRET_KEY
    secret: TURNSTILE_SECRET_KEY
  # Esempio con Secret Manager (RACCOMANDATO):
  # Per settare una variabile come secret:
  # 1. Crea il secret con: firebase apphosting:secrets:set NOME_SECRET --project sito-valentina-geusa
  # 2. Inserisci il valore quando richiesto
  # 3. Scommenta e usa la configurazione qui sotto, sostituendo NOME_SECRET con il nome del secret creato
  #
  # - variable: MAILGUN_DOMAIN
  #   secret: mailgun-domain-secret
  #   availability:
  #     - RUNTIME
  #
  # - variable: MAILGUN_API_KEY
  #   secret: mailgun-api-key-secret
  #   availability:
  #     - RUNTIME
  #
  # - variable: CONTACT_EMAIL
  #   secret: contact-email-secret
  #   availability:
  #     - RUNTIME

  # Script personalizzati (opzionale)
  # App Hosting rileva automaticamente Astro, ma puoi sovrascrivere se necessario
  # scripts:
  #   buildCommand: npm run build
  #   runCommand: node dist/server/entry.mjs

  # Configurazione output build (opzionale)
  # App Hosting ottimizza automaticamente, ma puoi specificare cosa includere
  # outputFiles:
  #   serverApp:
  #     include: [dist, public]
